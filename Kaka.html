<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Geolocate Safe Lookup</title>
<!-- Gradient ala bendera Rusia: putih, biru, merah secara vertikal -->
<style>
  :root {
    --accent: #4fd1c5;
    --bg-alpha: rgba(0,0,0,0.5);
    --radius: 16px;
    --transition: 0.35s cubic-bezier(.4,.2,.2,1);
    --glow: 0 0 20px rgba(79,209,197,0.7);
  }
  * {box-sizing:border-box;}
  body {
    margin:0;
    font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    min-height:100vh;
    background: linear-gradient(to bottom, white 33%, #0052b4 33%, #0052b4 66%, #d52b1e 66%);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:1rem;
    color:#fff;
    overflow:hidden;
  }
  .container {
    position:relative;
    width:100%;
    max-width:700px;
    background: rgba(0,0,0,0.5);
    border: 2px solid var(--accent);
    border-radius: var(--radius);
    padding:2rem;
    backdrop-filter: blur(10px);
    box-shadow: var(--glow);
    transition: all var(--transition);
    overflow:hidden;
  }
  .container.expanded {
    max-height: 2000px;
  }
  h1 {
    margin-top:0;
    font-size:1.8rem;
    text-align:center;
    letter-spacing:1px;
    position: relative;
  }
  .pulse {
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0% { text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); }
    50% { text-shadow: 0 0 30px #fff, 0 0 40px #fff; }
    100% { text-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); }
  }
  .input-group {
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin:1rem 0;
  }
  .input-group input {
    flex:1 1 100%;
    padding:12px 16px;
    border-radius:8px;
    border:2px solid var(--accent);
    background:rgba(255,255,255,0.05);
    color:#fff;
    font-size:1rem;
    outline:none;
    transition: transform var(--transition);
  }
  .input-group input:focus {
    transform: scale(1.02);
    border-color:#fff;
  }
  .btn {
    cursor:pointer;
    padding:12px 20px;
    background: linear-gradient(135deg, #4fd1c5, #81e6d9);
    border:none;
    border-radius:8px;
    font-weight:bold;
    position: relative;
    overflow:hidden;
    color:#000;
    flex:0 0 auto;
    transition: filter var(--transition), transform var(--transition);
    box-shadow: 0 0 15px rgba(255,255,255,0.3);
  }
  .btn:hover {
    transform: translateY(-2px);
    filter:brightness(1.1);
  }
  .result {
    margin-top:1rem;
    background: rgba(255,255,255,0.05);
    padding:1rem;
    border-radius:8px;
    position:relative;
    overflow:hidden;
    transition: max-height var(--transition);
    font-size:0.95rem;
  }
  .field {
    display:flex;
    justify-content: space-between;
    padding:6px 0;
    border-bottom:1px solid rgba(255,255,255,0.1);
  }
  .field:last-child {border-bottom:none;}
  .label {font-weight:600; opacity:0.85;}
  .value {font-family: monospace; text-align:right;}
  .loader {
    position:absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.6);
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    font-size:0.9rem;
    flex-direction: column;
    border-radius:8px;
  }
  .spinner {
    width:50px;
    height:50px;
    border:5px solid rgba(255,255,255,0.2);
    border-top-color: #4fd1c5;
    border-radius:50%;
    animation: spin 1s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .tag {background: rgba(255,255,255,0.08); padding:4px 10px; border-radius:999px; font-size:0.65rem; display:inline-block; margin-bottom:4px;}
  .faded {
    opacity:0;
    transform: translateY(10px);
    animation: appear 0.6s forwards;
  }
  @keyframes appear {
    to { opacity:1; transform: translateY(0); }
  }
</style>
</head>
<body>
  <div class="container" id="mainContainer">
    <h1 class="pulse">Lookup Info</h1>
    <div class="input-group">
      <input type="text" id="targetInput" placeholder="Masukkan IP atau domain milikmu (misal: 8.8.8.8 atau example.com)" aria-label="target"/>
      <button class="btn" id="searchBtn">Search</button>
    </div>
    <div id="results" class="result" aria-live="polite" style="max-height:0; overflow:hidden;">
      <!-- akan diisi dinamically -->
    </div>
  </div>

  <script>
    const btn = document.getElementById('searchBtn');
    const input = document.getElementById('targetInput');
    const results = document.getElementById('results');
    const container = document.getElementById('mainContainer');

    function createField(label, value) {
      const div = document.createElement('div');
      div.className = 'field';
      div.innerHTML = '<div class="label">' + label + '</div><div class="value">' + (value || 'â€”') + '</div>';
      return div;
    }

    async function fetchLookup(target) {
      // PENTING: ini memanggil backend Python yang kamu siapkan di /lookup (contoh)
      // backend harus melakukan validasi dan hanya mengizinkan lookup terhadap input yang sah (milik user sendiri)
      const resp = await fetch('/lookup', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({target})
      });
      if (!resp.ok) throw new Error('Gagal fetch data');
      return await resp.json();
    }

    function showLoader() {
      results.innerHTML = '';
      const loader = document.createElement('div');
      loader.className = 'loader';
      loader.innerHTML = '<div class="spinner"></div><div>Memproses...</div>';
      results.appendChild(loader);
      results.style.maxHeight = '1000px';
    }

    function showError(msg) {
      results.innerHTML = '';
      const err = document.createElement('div');
      err.style.color = '#ff6b6b';
      err.textContent = msg;
      results.appendChild(err);
      results.style.maxHeight = '500px';
    }

    function populate(data) {
      results.innerHTML = '';
      // Buat field sesuai yang tersedia
      const mapping = {
        ip: 'IP Address',
        hostname: 'Host Name',
        ip_range: 'IP Range',
        isp: 'ISP',
        organization: 'Organization',
        country: 'Country',
        region: 'Region',
        city: 'City',
        timezone: 'Timezone',
        carrier: 'Carrier',
        local_time: 'Local Time',
        postal: 'Postal Code',
        latitude: 'Latitude',
        longitude: 'Longitude'
      };
      for (const key in mapping) {
        const label = mapping[key];
        let val = data[key];
        if ((key === 'latitude' || key === 'longitude') && data.latitude && data.longitude) {
          // show together
          if (key === 'latitude') {
            val = data.latitude + ', ' + data.longitude;
          } else continue;
        }
        results.appendChild(createField(label, val));
      }
      // animasi expand
      results.style.maxHeight = '1500px';
    }

    btn.addEventListener('click', async () => {
      const target = input.value.trim();
      if (!target) return alert('Isi dulu targetnya.');
      showLoader();
      try {
        const data = await fetchLookup(target);
        if (data.error) {
          showError(data.error);
        } else {
          populate(data);
        }
      } catch (e) {
        showError('Error: ' + e.message);
      }
    });

    // enter key
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') btn.click();
    });
  </script>
</body>
</html>